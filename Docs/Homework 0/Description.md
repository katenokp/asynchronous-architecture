Получилось 3 сервиса
- Пользователи приезжают снаружи, отдельного сервиса для них нет, только модель данных
- Такс-трекер. Тут всё про создание, переназначение и выполнение тасок. Дашборд тоже тут. Генерация сумм за назначение и выполнение тасок пока тоже тут. Пока кажется, что эта логика ближе к таскам, а ещё не надо думать про то, что случится если аккаунтинг ещё не протупится когда таску переассайнят. Когда таска заассайнена или выполнена, вылетает событие. Его ловит сервис расчётов. В событии — описание таски, сумма (возможно, отрицательная) и userId какой-нибудь
- Сервис расчётов. Тут лог начислений и списаний. Тут же физические выплаты в конце дня и письма счастья пользователям. Дашборды аккаунтинга тоже тут
	- Событие о том, что случилось начисление или списание. В событии дата, сумма, accountId. UserId вероятно не нужен
	- Событие о том, что физические деньги пользователю выплачены (или, кстати, не выплачены, баланс отрицательный, такое тоже можно кидать событием чтобы сервис аналитики баланс перенёс)
- Сервис аналитики. Самый мутный сервис пока что. Тут всё вокруг дня, к дню привязана стопка балансов, которые меняются в ответ на события из сервиса аккаунтинга. День получился центральной сущностью чтобы джойнами не обкладываться. Но кажется, что эта схема не очень гибкая и если что-то изменится в требованиях бизнеса, будет больно переделывать

![EventStorming0.svg](EventStorming.svg)

- В сервисе аналитики возможно ещё надо самую дорогую задачу за день зафиксировать, чтобы не высчитывать каждый раз. Непонятно, только, когда. Можно в аккаунтинг добавить событие вида "всё обработано", но тогда становится важен порядок событий



Модель данных
![DataModel0.svg](DataModel0.svg)

Связи по данным как будто нет, везде в событии будет всё нужное приезжать. Связи все асинхронные

У каждого сервиса своя база. Сервисы общаются друг с другом событиями. Если какой-то сервис упадёт или затупит ненадолго, у пользователя отпадёт кусок функциональности, остальные сервисы проблем не заметят. Если отпадёт кролик, будет грустнее. Если это критично, можно перед кроликом базу воткнуть, но это как-то попахивает уже. Ещё для штук, которые работают по расписанию (в аккаунтинге и возможно в аналитике) нужно проверять, что последний запуск отработал. А по-хорошему подумать про то, что будет если робот не один день лежал.
Ещё роботов надо правильно написать, с возможностью повторного запуска